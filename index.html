<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../../../favicon.ico">

    <title>Timetable Calculator</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">

    <!-- Custom styles for this template -->
    <style type="text/css">
        body {
            padding-top: 5rem;
            background-color: grey;
        }
    </style>
</head>

    
<body>

    
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
        <a class="navbar-brand" href="#">Navbar</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Link</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link disabled" href="#">Disabled</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="http://example.com" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dropdown</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown01">
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item" href="#">Another action</a>
                        <a class="dropdown-item" href="#">Something else here</a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>

    <main role="main" class="container">

        <div class="container">
            <div class="row">
                <div class="col-md-2">
                    <br><br><br><br><br><br>
                    
                    <h1 class="text-center">Select Lesson:</h1>

                    <br>

                    <div class="form-check">
                        <input id="button1" name="buttons" value="1" type="radio" ></input>
                        <label for="button1" class="form-check-label font-weight-bold">Subject 1</label>
                        <br>
                        <input id="button2" name="buttons" value="2" type="radio" ></input>
                        <label for="button2" class="form-check-label font-weight-bold">Subject 2</label>
                        <br>
                        <input id="button3" name="buttons" value="3" type="radio" ></input>
                        <label for="button3" class="form-check-label font-weight-bold">Subject 3</label>
                        <br>
                        <input id="button4" name="buttons" value="4" type="radio" ></input>
                        <label for="button4" class="form-check-label font-weight-bold">Subject 4</label>
                        <br>
                        <input id="button5" name="buttons" value="5" type="radio" ></input>
                        <label for="button5" class="form-check-label font-weight-bold">Subject 5</label>
                        <br>
                        <input id="button6" name="buttons" value="6" type="radio" ></input>
                        <label for="button6" class="form-check-label font-weight-bold">Subject 6</label>
                    </div>



                </div>

                <div class="col-md-8">
                    <div>
                        <h1 style="text-decoration: underline;">Timetable Calculator</h1>
                        <br>
                    </div>
                    <b>Week 1</b>
                    <table id="week1Table" class="table table-dark table-sm"></table>
                    <b>Week 2</b>
                    <table id="week2Table" class="table table-dark table-sm"></table>
                </div>
            </div>
        </div>

        <div class="form-group ">
            <div class="row">
                <div class="col">
                    <label for="lesson1" style="font-weight: bold;">Subject 1: </label>
                    <input id="lesson1" name="lessons" class="form-control" style="background-color:fuchsia"></input>
                </div>
                <div class="col">
                    <label for="lesson2" style="font-weight: bold;">Subject 2: </label>
            <input id="lesson2" name="lessons" class="form-control" style="background-color:olive"></input> 
                </div>
                <div class="col">
                    <label for="lesson3" style="font-weight: bold;">Subject 3: </label>
                    <input id="lesson3" name="lessons" class="form-control" style="background-color:aqua"></input>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <label for="lesson4" style="font-weight: bold;">Subject 4: </label>
                    <input id="lesson4" name="lessons" class="form-control" style="background-color:silver"></input>
                </div>
                <div class="col">
                    <label for="lesson5" style="font-weight: bold;">Subject 5: </label>
                    <input id="lesson5" name="lessons" class="form-control" style="background-color:maroon"></input>
                </div>
                <div class="col">
                    <label for="lesson6" style="font-weight: bold;">Subject 6: </label>
                    <input id="lesson6" name="lessons" class="form-control" style="background-color:lime"></input>
                </div>

            </div>
        </div>

        <button class="btn" onclick="calcLessons()">Click me</button>

        <br>

        <h1 id="answer">Answer Will appear here</h1>
        
        <br><br>

    </main>
    <!-- /.container -->
    
    
    <script type="text/javascript">

        function getSelected(){
            let buttons = document.getElementsByName('buttons');
            for (let button of buttons){
                
                if (button.checked) return(button.value);

            }
            return('');
        }
        
        function cellClicked(myId){
            let subject = getSelected();
            
            if (subject){
                
            let colors = ['fuchsia','olive','aqua','silver','maroon','lime'];
            myId.style.backgroundColor = colors[subject - 1];
                
            let lesson = document.getElementById('lesson' + subject);
            myId.value = lesson.value;
            
            }
        }
        
        function getTimetable(){
            let array = [[[],[],[],[],[]],[[],[],[],[],[]]];
            
            for (let i = 0; i < 5; i++){
                
                for (let t = 0; t < 5; t++){
                    
                    for (let j = 0; j < 2; j++){
                        
                        let currCellId = 'cell' + j + t + i;
                        let currCell = document.getElementById(currCellId);
                        let value = currCell.value;
                        
                        array[j][i].push(value);
                    
                    }
                }
            }
            return(array);
        }
        
        function getSubjects(){
            let array = []
            let lessons = document.getElementsByName('lessons');
            for (let lesson of lessons){
                
                array.push(lesson.value)
            }
            return(array);
        }
        
        
        
        
        function makeTable(myId,num){
            let table = document.getElementById(myId);
            let row = table.insertRow(0);

            row.insertCell(0).innerHTML = '';
            row.insertCell(1).innerHTML = 'Period 1';
            row.insertCell(2).innerHTML = 'Period 2';
            row.insertCell(3).innerHTML = 'Period 3';
            row.insertCell(4).innerHTML = 'Period 4';
            row.insertCell(5).innerHTML = 'Period 5';

            let days = ['Monday','Tuesday','Wednesday','Thursday','Friday'];

            
            for (let i=1; i < 6; i++){

                let newRow = table.insertRow(i);

                for (let t=0; t<6; t++){

                    let cellid = 'cell' + num + (t-1) + (i-1);

                    let insideHtml = "<input size='1' class='form-control' id = '" + cellid + "' onclick='cellClicked(" + cellid + ")' readonly> </input>";
                    if (t==0) {
                        newRow.insertCell(t).innerHTML = days[i - 1];

                    }else{
                        newRow.insertCell(t).innerHTML = insideHtml;
                    }
                }
            }
        }

        makeTable('week1Table',0);
        makeTable('week2Table',1);
        
        let t1start = new Date(2019,8,4);//give the starts as the first day back and the ends as the last school day
        let t1end = new Date(2019,9,25);
        let t2start = new Date(2019,10,4);
        let t2end = new Date(2019,11,20);
        let t3start = new Date(2020,0,7);
        let t3end = new Date(2020,1,14);
        let t4start = new Date(2020,1,24);
        let t4end = new Date(2020,3,3);
        let t5start = new Date(2020,2,20);
        let t5end = new Date(2020,4,22);
        let t6start = new Date(2020,5,1);
        let t6end = new Date(2020,6,17);
        let dates = [t1start,t1end,t2start,t2end,t3start,t3end,t4start,t4end,t5start,t5end,t6start,t6end];

        let p1start = [9,0];//means 9:00 am
        let p1end = [10,0]
        let p2start = [10,15];
        let p2end = [11,15];
        let p3start = [11,30];
        let p3end = [12,30];
        let p4start = [13,20];
        let p4end = [14,20];
        let p5start = [14,25];
        let p5end = [15,25];
        let times = [p1start,p1end,p2start,p2end,p3start,p3end,p4start,p4end,p5start,p5end];

        //let s1 = 'Maths';
        //let s2 = 'Further Maths';
        //let s3 = 'Computing';
        //let s4 = 'Physics';
        //let s5 = 'Tutor Group';
        //let s6 = 'Free';
        //let subjects = [s1,s2,s3,s4,s5,s6];

        //let timetable = [[[s6,s4,s4,s4,s6],[s2,s3,s3,s1,s2],[s2,s4,s2,s3,s3],[s2,s1,s1,s3,s3],[s4,s4,s6,s4,s1]],
        //[[s3,s2,s3,s4,s1],[s6,s1,s4,s1,s1],[s2,s3,s5,s6,s6],[s3,s2,s1,s6,s2],[s1,s4,s6,s2,s6]]];

        function getWeekday(date) {
            let day = date.getDay();
            if (day == 0) {
                day = 7;
            }
            return(day);
        }

        function checkSameDay(date1,date2) {
            if(getDayString(date1) === getDayString(date2)){
                return(true);
            }else{
                return(false);
            }
        }

        function getDayString(date) {
            let month = String(date.getMonth());
            month = (month.length == 1) ? '0' + month : month;
            let num = String(date.getDate());
            num = (num.length == 1) ? '0' + num : num;
            let output = String(date.getFullYear() + month + num);
            return(output);
        }

        function addDay(date) {
            let result = new Date(date);
            result.setDate(result.getDate() + 1);
            return(result);
        }

        function checkSchoolDay(date) {
            let schoolTerm = false;
            if (getWeekday(date) < 6){
                for(let i = 0;i<12;i += 2){
                    schoolTerm = (getDayString(date) >= getDayString(dates[i]) && getDayString(date) <= getDayString(dates[i+1])) ? true : false;
                    if (schoolTerm){
                        break;
                    }
                }
            }
            return(schoolTerm);
        }

        function calcWholeDays(date1,date2) {
            let loop = true;
            let week = 1;//0 = week1  1 = week2  starts on week2 because it flips before adding the day
            let currDate = t1start;
            let days = [[0,0,0,0,0],[0,0,0,0,0]];
            let lastDate = new Date(1111,1,1);
            while(loop){

                if (checkSchoolDay(currDate)){
                    if (getDayString(currDate) > getDayString(addDay(lastDate))){//if its been more than a days since the last schoolday
                        week = (week) ? 0 : 1;//flips week
                    }

                    if (getDayString(currDate) > getDayString(date1)){

                        days[week][getWeekday(currDate) - 1] += 1;//adds 1 to days tally

                    }
                    lastDate = currDate;
                }

                currDate = addDay(currDate);//loop incrementor

                if (getDayString(currDate) >= getDayString(date2)){//loop breaker if they are on the same day or after
                    loop = false;
                }
            }
            return(days);

        }

        function countOccurence(item,list) {//counts number of times item occurs in list
            let count = 0;
            for(let i = 0 ; i < list.length ; i++){
                if (list[i] == item){
                    count++;
                }
            }
            return(count);

        }

        function calcSubjectPerDay(subjects,timetable) {
            let timetableTotals = [[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]],[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]]];
            for (let i = 0; i < 5; i++){
                for (let j = 0; j < 6; j++){
                    timetableTotals[0][i][j] += countOccurence(subjects[j],timetable[0][i]);
                    timetableTotals[1][i][j] += countOccurence(subjects[j],timetable[1][i]);
                }
            }
            return(timetableTotals);
        }

        function calcTotalSubjects(date1,date2,subjects,timetable) {
            let SubjectsPerDay = calcSubjectPerDay(subjects,timetable);
            let WholeDays = calcWholeDays(date1,date2);
            let totalSubjects = [0,0,0,0,0,0];

            for (let i = 0; i < 6; i++){
                for (let j = 0; j < 5; j++){
                    totalSubjects[i] += WholeDays[0][j] * SubjectsPerDay[0][j][i];
                    totalSubjects[i] += WholeDays[1][j] * SubjectsPerDay[1][j][i];
                }
            }
            return(totalSubjects);
        }

        function getCurrentPeriod(date) {
            let hour = date.getHours() + 1;//+1 because we want 1 to mean 12am - 1am not 1am - 2am
            let minute = date.getMinutes() + 1;//same reason
            let totalMinutes = hour * 60 + minute;
            let timesTotalMinutes = 0;
            let period = null;
            for (let i = 0; i < 10; i++){
                timesTotalMinutes = times[i][0] * 60 + times[i][1]
                if (totalMinutes < timesTotalMinutes){
                    period = i;
                    break;
                }
            }
            if (totalMinutes >= timesTotalMinutes){
                period = 10;
            }
            return(period);
        }

        function getWeekNum(date) {//warning if run on a holiday it will return the week number prior to the holiday
            let loop = true;
            let currDate = t1start;
            let week = 1;//0 = week1  1 = week2  starts on week2 because it flips before adding the day
            let lastDate = new Date(1111,1,1);
            let actualWeek = null;
            while (loop == true){

                if (checkSchoolDay(currDate)){

                    if (getDayString(currDate) > getDayString(addDay(lastDate))){//if its been more than a days since the last schoolday
                        week = (week) ? 0 : 1;//flips week
                    }

                    lastDate = currDate;
                }

                if (getDayString(currDate) == getDayString(date)){//loop breaker if day is a school day
                    loop = false;
                    actualWeek = week;
                }
                currDate = addDay(currDate);//loop incrementor
            }
            return(actualWeek);
        }

        function addPartialDayLessons(date,totalSubjects,start,subjects,timetable) {//0 = all  1 = period2 onwards ...
            let dayNumber = getWeekday(date);
            let index = 0;
            let week = getWeekNum(date);
            for (let i = start; i < 5; i++){
                index = subjects.indexOf(timetable[week][dayNumber - 1][i]);
                totalSubjects[index]++;
            }
            return(totalSubjects);
        }

        function addTodaysLessons(date,totalSubjects,subjects,timetable) {
            if (checkSchoolDay(date)){
                let period = getCurrentPeriod(date);
                let start = Math.ceil(period/2);
                if (period < 9){
                    totalSubjects = addPartialDayLessons(date,totalSubjects,start,subjects,timetable);
                }
            }
            return(totalSubjects);
        }

        function calcCompleteLessonsBetween(subjects,timetable) {
            let date1 = new Date();
            let date2 = new Date(2020,6,17);
            let totalSubjects = calcTotalSubjects(date1,date2,subjects,timetable);
            totalSubjects = addTodaysLessons(date1,totalSubjects,subjects,timetable);
            return(totalSubjects);
        }

        
        function calcLessons(){
            let subjects = getSubjects();
            let timetable = getTimetable();
        
            let output = calcCompleteLessonsBetween(subjects,timetable);
            
            for (let i = 0; i < subjects.length; i++){//search linealy through the array for any duplicates and deletes their output along with their subject
                for (let t = 0; t < subjects.length; t++){
                    if (subjects[i] == subjects[t] && i != t){
                        
                        output.splice(t,1);
                        subjects.splice(t,1);
                        t -= 1; //need to decrease t as the list just got shorter
                    }
                }
            }
            
            for (let i = 0; i < subjects.length; i++){
                if (subjects[i] == ""){
                    
                    subjects[i] = 'Free(s)';
                }
            }
            
            answer.innerHTML = output + subjects;
        }



    </script>
    

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>

    
</body>
</html>
